name: Multi Windows Farm

on:
  workflow_dispatch:
  repository_dispatch:
    types: [restart-farm]

jobs:
  farm:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Instances
        run: |
          # 觸發 5 台獨立實例（可加/減）
          curl -X POST https://api.github.com/repos/${{ github.repository }}/actions/workflows/rdp-single.yml/dispatches \
            -H "Authorization: token ${{ secrets.AUTO_RESTART_PAT }}" \
            -H "Accept: application/vnd.github.v3+json" \
            -d '{"ref":"main", "inputs": {"instance": "1", "tskey": "${{ secrets.TS_KEY_1 }}"}}'
          sleep 10
          curl -X POST https://api.github.com/repos/${{ github.repository }}/actions/workflows/rdp-single.yml/dispatches \
            -H "Authorization: token ${{ secrets.AUTO_RESTART_PAT }}" \
            -H "Accept: application/vnd.github.v3+json" \
            -d '{"ref":"main", "inputs": {"instance": "2", "tskey": "${{ secrets.TS_KEY_2 }}"}}'
          sleep 10
          curl -X POST https://api.github.com/repos/${{ github.repository }}/actions/workflows/rdp-single.yml/dispatches \
            -H "Authorization: token ${{ secrets.AUTO_RESTART_PAT }}" \
            -H "Accept: application/vnd.github.v3+json" \
            -d '{"ref":"main", "inputs": {"instance": "3", "tskey": "${{ secrets.TS_KEY_3 }}"}}'
          sleep 10
          curl -X POST https://api.github.com/repos/${{ github.repository }}/actions/workflows/rdp-single.yml/dispatches \
            -H "Authorization: token ${{ secrets.AUTO_RESTART_PAT }}" \
            -H "Accept: application/vnd.github.v3+json" \
            -d '{"ref":"main", "inputs": {"instance": "4", "tskey": "${{ secrets.TS_KEY_4 }}"}}'
          sleep 10
          curl -X POST https://api.github.com/repos/${{ github.repository }}/actions/workflows/rdp-single.yml/dispatches \
            -H "Authorization: token ${{ secrets.AUTO_RESTART_PAT }}" \
            -H "Accept: application/vnd.github.v3+json" \
            -d '{"ref":"main", "inputs": {"instance": "5", "tskey": "${{ secrets.TS_KEY_5 }}"}}'
